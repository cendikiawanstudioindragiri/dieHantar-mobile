import 'dart:convert';\nimport 'dart:typed_data';\nimport 'package:http/http.dart' as http;\nimport 'package:image_picker/image_picker.dart';\n\nclass ImageUploadService {\n  // Alamat IP 10.0.2.2 adalah alias khusus untuk localhost dari emulator Android.\n  // Untuk iOS atau web, Anda bisa menggunakan 'localhost' atau '127.0.0.1'.\n  final String _baseUrl = \"http://10.0.2.2:8080\";\n\n  Future<String?> pickAndUploadImage() async {\n    final picker = ImagePicker();\n    // Ambil gambar dari galeri\n    final XFile? image = await picker.pickImage(source: ImageSource.gallery);\n\n    if (image == null) {\n      // Pengguna membatalkan pemilihan gambar\n      return null;\n    }\n\n    // Buat request multipart\n    var request = http.MultipartRequest(\n      'POST',\n      Uri.parse('$_baseUrl/upload-image/'),\n    );\n\n    // Baca data gambar sebagai bytes\n    final Uint8List imageBytes = await image.readAsBytes();\n\n    // Tambahkan file ke request\n    request.files.add(\n      http.MultipartFile.fromBytes(\n        'file', // 'file' harus cocok dengan nama argumen di endpoint FastAPI\n        imageBytes,\n        filename: image.name, // sertakan nama file asli\n      ),\n    );\n\n    try {\n      final streamedResponse = await request.send();\n\n      if (streamedResponse.statusCode == 200) {\n        final response = await http.Response.fromStream(streamedResponse);\n        final responseData = json.decode(response.body);\n        \n        // Asumsikan backend mengembalikan JSON dengan kunci 'public_url'\n        // (Kita akan mengimplementasikannya di backend nanti)\n        print(\"Upload berhasil. URL Gambar: \${responseData['public_url']}\");\n        return responseData['public_url'];\n      } else {\n        // Tangani error dari server\n        final errorBody = await http.Response.fromStream(streamedResponse);\n        print(\"Gagal mengunggah. Status: \${streamedResponse.statusCode}\");\n        print(\"Error: \${errorBody.body}\");\n        return null;\n      }\n    } catch (e) {\n      // Tangani error jaringan\n      print(\"Terjadi kesalahan jaringan: $e\");\n      return null;\n    }\n  }\n}\n