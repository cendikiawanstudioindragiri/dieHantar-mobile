version: '3.8'

services:
  localstack:
    image: localstack/localstack:latest
    ports:
      # Port-port ini diekspos ke mesin host Anda
      - "4566:4566"            # Gateway utama LocalStack
      - "8080:8080"            # Firestore Emulator
      - "9099:9099"            # Auth Emulator
    environment:
      # Menentukan layanan yang ingin diaktifkan. Di sini kita fokus pada Firestore & Auth.
      - SERVICES=firestore,auth
      # Atur project ID default untuk konsistensi
      - GCLOUD_PROJECT=local-dev
      # Mode DEBUG untuk melihat log yang lebih detail jika perlu
      - DEBUG=1
    volumes:
      # Volume ini menyimpan state LocalStack agar data tetap ada saat container di-restart
      - ./localstack_data:/var/lib/localstack
      - "/var/run/docker.sock:/var/run/docker.sock"
